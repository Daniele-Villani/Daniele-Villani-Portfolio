# VulnHub - Basic Pentesting 1 Writeup

## Table of Contents
1. [Challenge Information](#challenge-information)
2. [Description](#description)
3. [Solution](#solution)
   - [Step 1: Initial Enumeration](#step-1-initial-enumeration)
   - [Step 2: Exploitation](#step-2-exploitation)
   - [Step 3: Post-Exploitation](#step-3-post-exploitation)
4. [Lessons Learned](#lessons-learned)
5. [Conclusion](#conclusion)

## Challenge Information
- **CTF Name:** VulnHub - Basic Pentesting 1
- **Category:** Web, Network Exploitation
- **Difficulty:** Beginner

## Description
In this challenge, I exploited a vulnerable system to gain root access. The process involved identifying open ports, discovering vulnerabilities, and leveraging those weaknesses to escalate privileges.

## Solution

### Step 1: Initial Enumeration

#### Finding Victim IP
I began by identifying the victim's IP address range on the network using Nmap.
```bash
nmap 10.6.6.0/24
```

![Pasted image 20240724170854](https://github.com/user-attachments/assets/273cef9c-1d80-4539-b412-30f1b8e27825)

#### Finding Open Ports
Next, I scanned the identified IP address for open ports and services to understand what was running on the system.
```bash
nmap -sVC -p- -oN nmap -T4 10.6.6.11 -v 
```

![Pasted image 20240724171629](https://github.com/user-attachments/assets/49dc1a90-9bb2-4718-b8bd-c07df1585240)


The web page hosted on port 80 showed a default Apache server page, which revealed the fact that the server was running with default settings.
```html
<html><body><h1>It works!</h1>
<p>This is the default web page for this server.</p>
<p>The web server software is running but no content has been added, yet.</p>
</body></html>
```

![Pasted image 20240724171723](https://github.com/user-attachments/assets/8a86f89f-1caf-4455-9061-cef5ea4ad7f1)

### Step 2: Exploitation

#### Fuzzing for Hidden Directories
I proceeded to discover hidden directories on the web server by using `ffuf` with a comprehensive wordlist.
```bash
ffuf -c -w /usr/share/seclists/Discovery/Web-Content/big.txt -u "http://10.6.6.11/FUZZ"
```

![Pasted image 20240724190602](https://github.com/user-attachments/assets/8664839d-2ade-4046-9834-bf20bb57bb74)

I found a `/secret/` directory which contained a login page.

![Pasted image 20240724190751](https://github.com/user-attachments/assets/85ba38c0-de23-4345-a0b4-346c8e575ee4)
![Pasted image 20240724190811](https://github.com/user-attachments/assets/69c83f7f-4486-4682-a8bc-4f65c7eaad12)
![Pasted image 20240724190852](https://github.com/user-attachments/assets/e55c15fd-8185-4a71-bb9a-8ac31ac6cd5e)


I was able to log in using the default credentials `admin:admin`.

![Pasted image 20240724191008](https://github.com/user-attachments/assets/a2f5bbb9-9de4-497f-a0af-a906fa9283b0)

#### Exploiting the Web Application
I activated the Hello Dolly plugin on the WordPress site. To gain shell access, I used the reverse PHP shell script from `/usr/share/webshells/php/php-reverse-shell.php`.

![Pasted image 20240724195525](https://github.com/user-attachments/assets/85f865f4-ef1f-4733-8380-70e6e119a527)
![Pasted image 20240724195755](https://github.com/user-attachments/assets/49d7c517-1322-40db-9653-b29500bc087b)

I pasted the PHP reverse shell code into the Hello Dolly plugin editor, configured it with my IP, and started a listener on my machine.
```bash
cat /usr/share/webshells/php/php-reverse-shell.php
```
![Pasted image 20240724195914](https://github.com/user-attachments/assets/e968913e-8938-4806-8d8f-8bada99b097f)
![Pasted image 20240724195959](https://github.com/user-attachments/assets/e735ae9d-4ed2-4909-9e2a-39614dcceef4)

After updating the plugin, I successfully received a shell connection.

![Pasted image 20240724200043](https://github.com/user-attachments/assets/a61e836f-af27-4ac6-a524-4dcb7b5781c5)

I then spawned a TTY shell for better interaction.
```bash
python3 -c 'import pty; pty.spawn("/bin/sh")'
```

#### Privilege Escalation
To further escalate privileges, I opened a web server on my machine where `linpeas.sh`, a privilege escalation script, is located

![Pasted image 20240724201511](https://github.com/user-attachments/assets/0e1844c2-a7f8-4865-ac3b-8fce2f6c6a01)

I then navigated to a writable directory on the victim machine, specifically `/var/metrics`.

![Pasted image 20240724201735](https://github.com/user-attachments/assets/72ae810a-7a73-47b0-ad2d-415d32a36a03)

I downloaded `linpeas.sh` from my attacker machine and set execution permissions.

![Pasted image 20240724201835](https://github.com/user-attachments/assets/fc50a95f-59e3-4afb-80e9-3e19743156a1)

I ran `linpeas.sh`, which revealed a couple critical findings:
- `/etc/passwd` was writable
- Hashed password for the `marlinspike` user in the shadow file

![Pasted image 20240724202002](https://github.com/user-attachments/assets/25bd4f68-e018-4e95-9123-38b1f7c6a716)
![Pasted image 20240724202927](https://github.com/user-attachments/assets/9d49e400-1af4-44de-8cda-50861e07fc92)
![Pasted image 20240724203022](https://github.com/user-attachments/assets/b87860c8-7f5e-4103-b39e-f47cf4ccd34f)

I created a file with the `marlinspike` user and its hashed password:
`marlinspike:$6$wQb5nV3T$xB2WO/jOkbn4t1RUILrckw69LR/0EMtUbFFCYpM3MUHVmtyYW9.ov/aszTpWhLaC2x6Fvy5tpUUxQbUhCKbl4/`

Using John the Ripper, I cracked the password.

![Pasted image 20240724205014](https://github.com/user-attachments/assets/86946842-2f38-4ee1-b076-f2705eadc7dd)

I logged in through SSH with the cracked credentials.

![Pasted image 20240724205131](https://github.com/user-attachments/assets/4d9c55ab-ff82-4ac2-a90e-8b503a165d26)

The `marlinspike` user had sudo privileges to execute all commands.

![Pasted image 20240724205232](https://github.com/user-attachments/assets/372c1888-4e3f-4dba-a687-2465e0c567f0)

I ran a bash shell with sudo to gain root access.

![Pasted image 20240724205310](https://github.com/user-attachments/assets/1fdc59be-feee-4f6a-b9f1-59f0377956af)

#### Alternate Method: FTP Exploitation
As an alternative, I identified that the FTP service was also vulnerable with a backdoor.

![Pasted image 20240724182250](https://github.com/user-attachments/assets/b97d95b8-ca3e-4298-9873-c7de044dfdad)

I exploited this vulnerability using a script from [GitHub](https://github.com/shafdo/ProFTPD-1.3.3c-Backdoor_Command_Execution_Automated_Script/blob/main/proFTPD_1.3.3c_exploit.py) to gain root access.

![Pasted image 20240724184759](https://github.com/user-attachments/assets/a98b5868-caeb-4137-bc4b-7968faed8d19)

## Lessons Learned
- Thorough enumeration of services and directories is crucial for uncovering hidden vulnerabilities.
- Leveraging multiple attack vectors can provide alternate paths to the same goal.
- Understanding the interplay between different services and their configurations can reveal unexpected weaknesses.
- Automation tools like `ffuf` and `linpeas` are invaluable for speeding up the exploitation and enumeration processes.

## Conclusion
This challenge was a comprehensive exercise in exploiting multiple vulnerabilities across different services. By using both web application and FTP service exploits, I successfully gained and escalated privileges to root access. The experience underscored the importance of meticulous enumeration, searching  for information and critical thinking, the benefits of leveraging various tools and techniques in penetration testing. I later found out through other walkthroughs about other attack vectors which i did not explore into, like the MySQL credentials found in /var/www/html/secret/wp-admin/wp-config.php.
